<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns:sd="http://www.w3.org/1999/xhtml">
    <head th:replace="fragments/head :: head"></head>
    <body>
        <header th:replace="fragments/header :: header"></header>
        <main>
            <section class="text-center">
                <div class="container-fluid">
                    <h1 class="mt-3" th:text="'Liste des dossiers ' + ${yearFilter}"></h1>
                    <form th:action="@{/dossiers}" method="get">
                        <div class="row my-3">
                            <div style="width: 350px;">
                                <div class="input-group">
                                    <label class="input-group-text">Année universitaire</label>
                                    <select class="form-select" name="yearFilter">
                                        <option disabled value="">Choisir</option>
                                        <option th:selected="${yearFilter == year}" th:each="year : ${years}" th:value="${year}" th:text="${year} + ' - ' + ${year + 1} "></option>
                                    </select>
                                </div>
                            </div>
                            <div style="width: 350px;">
                                <div class="input-group">
                                    <label class="input-group-text" th:for="typeIndividu">Type d'individus</label>
                                    <select id="typeIndividu" class="form-select" name="typeIndividu">
                                        <option value="">Choisir</option>
                                        <option th:selected="${typeIndividu == enumType}"
                                                th:each="enumType : ${typeIndividuList}"
                                                th:value="${enumType}"
                                                th:text="#{'dossier.type-individu.' + ${enumType}}"></option>
                                    </select>
                                </div>
                            </div>
                            <div style="width: 350px;">
                                <div class="input-group">
                                    <label class="input-group-text" th:for="statusDossier">Statut</label>
                                    <select id="statusDossier" class="form-select" name="statusDossier">
                                        <option value="">Choisir</option>
                                        <option th:selected="${statusDossier == enumStatus}"
                                                th:each="enumStatus : ${statusDossierList}"
                                                th:value="${enumStatus}"
                                                th:text="#{'dossier.status-dossier.' + ${enumStatus}}"></option>
                                    </select>
                                </div>
                            </div>
                            <div style="width: 350px;">
                                <input class="form-control"
                                        type="text"
                                        placeholder="nom, prénom, numéro étudiant"
                                        name="fullTextSearch"
                                        id="fullTextSearch"
                                        size="50"
                                        th:value="${fullTextSearch}"> &nbsp;
                            </div>
                            <div class="col-3 text-start">
                                <input class="btn btn-success" type="submit" value="Rechercher">
                                <a class="btn btn-secondary" id="btnClear" th:href="@{/dossiers}">Effacer</a>
                                <a class="btn btn-primary" th:href="@{/individus/create}">Ajouter un individu</a>
                            </div>
                        </div>
                    </form>

                    <table class="table table-striped table-responsive">
                        <thead class="text-center mt-2 mb-2 table-secondary">
                            <tr class="text-start">
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="individu.numEtu">Numéro étudiant</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="civilite">Civilite</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="individu.name">Nom</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="individu.firstName">Prénom</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="individu.dateOfBirth">Date de naissance</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="type">Type Individu</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="statusDossier">Statut du dossier</a>
                                </th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            <tr th:each="dossierIndividuDto : ${dossiers}" class="align-middle text-start">
                                <td th:utext="${dossierIndividuDto.numEtu}"></td>
                                <td th:utext="${dossierIndividuDto.civilite != null} ? #{'individu.civilite.'+${dossierIndividuDto.civilite}} : 'Inconnue'"></td>
                                <td th:utext="${#strings.capitalize(#strings.toLowerCase(dossierIndividuDto.name))}"></td>
                                <td th:utext="${#strings.capitalize(#strings.toLowerCase(dossierIndividuDto.firstName))}"></td>
                                <td th:utext="${#temporals.format(dossierIndividuDto.dateOfBirth, 'dd/MM/yyyy')}"></td>
                                <td th:utext="#{'dossier.type-individu.' +${dossierIndividuDto.type}}"></td>
                                <!-- <td th:utext="#{'dossier.status-dossier.' +${dossierIndividuDto.statusDossier}}"></td>
                                 <td>-->

                               <!-- <td th:if="${dossierIndividuDto.statusDossier == dossierIndividuDto.statusDossier.SUIVI}"><span class="badge text-bg-success">Suivi</span></td>
                                <td th:if="${dossierIndividuDto.statusDossier == dossierIndividuDto.statusDossier.IMPORTE}"><span class="badge text-bg-danger">Importe</span></td>
                                <td th:if="${dossierIndividuDto.statusDossier == dossierIndividuDto.statusDossier.AJOUT_MANUEL}"><span class="badge text-bg-secondary">Ajout manuel</span></td>
                                <td th:if="${dossierIndividuDto.statusDossier == dossierIndividuDto.statusDossier.ACCUEILLI_ENTRETIEN_PHYSIQUE}">
                                    <span class="badge text-bg-warning">Accueilli en présentiel</span></td>
                                <td th:if="${dossierIndividuDto.statusDossier == dossierIndividuDto.statusDossier.ACCUEILLI_ENTRETIEN_TELEPHONIQUE_MAIL}">
                                    <span class="badge text-bg-light">Accueilli à distance par tél ou mail</span></td>
                                <td th:if="${dossierIndividuDto.statusDossier == dossierIndividuDto.statusDossier.IMPOSSIBLE_A_CONTACTER}">
                                    <span class="badge text-bg-dark">Impossible à contacter</span></td>
                                <td th:if="${dossierIndividuDto.statusDossier == dossierIndividuDto.statusDossier.RECU_PAR_LA_MEDECINE_PREVENTIVE}">
                                    <span class="badge text-bg-primary">Reçu par la médecine préventive</span></td>-->

                                <th:block th:switch="${dossierIndividuDto.statusDossier}">
                                    <td th:case="${dossierIndividuDto.statusDossier.SUIVI}"><span th:text="#{'dossier.status-dossier.' +${dossierIndividuDto.statusDossier.SUIVI}}" class="badge text-bg-success"></span></td>
                                    <td th:case="${dossierIndividuDto.statusDossier.IMPORTE}"><span th:text="#{'dossier.status-dossier.' +${dossierIndividuDto.statusDossier.IMPORTE}}" class="badge text-bg-danger"></span></td>
                                    <td th:case="${dossierIndividuDto.statusDossier.AJOUT_MANUEL}"><span th:text="#{'dossier.status-dossier.' +${dossierIndividuDto.statusDossier.AJOUT_MANUEL}}" class="badge text-bg-danger"></span></td>
                                    <td th:case="${dossierIndividuDto.statusDossier.ACCUEILLI_ENTRETIEN_PHYSIQUE}"><span th:text="#{'dossier.status-dossier.' +${dossierIndividuDto.statusDossier.ACCUEILLI_ENTRETIEN_PHYSIQUE}}" class="badge text-bg-warning"></span></td>
                                    <td th:case="${dossierIndividuDto.statusDossier.ACCUEILLI_ENTRETIEN_TELEPHONIQUE_MAIL}"><span th:text="#{'dossier.status-dossier.' +${dossierIndividuDto.statusDossier.ACCUEILLI_ENTRETIEN_TELEPHONIQUE_MAIL}}" class="badge text-bg-light"></span></td>
                                    <td th:case="${dossierIndividuDto.statusDossier.IMPOSSIBLE_A_CONTACTER}"><span th:text="#{'dossier.status-dossier.' +${dossierIndividuDto.statusDossier.IMPOSSIBLE_A_CONTACTER}}" class="badge text-bg-dark"></span></td>
                                    <td th:case="${dossierIndividuDto.statusDossier.RECU_PAR_LA_MEDECINE_PREVENTIVE}"><span th:text="#{'dossier.status-dossier.' +${dossierIndividuDto.statusDossier.RECU_PAR_LA_MEDECINE_PREVENTIVE}}" class="badge text-bg-primary"></span></td>
                                </th:block>

                                <td>
                                    <ul class="list-group list-group-horizontal">
                                        <li class="list-group-item border-0 p-1 bg-transparent">
                                            <a class="btn btn-info" th:href="@{/dossiers/{id}(id=${dossierIndividuDto.id})}" role="button"><i class="bi bi-eye"></i>
                                            </a>
                                        </li>
                                        <li class="list-group-item border-0 p-1 bg-transparent">
                                            <a data-bs-toggle="modal"
                                                    href="#"
                                                    data-bs-target="#modal-warning"
                                                    th:attr="data-bs-target='#modal-warning'+${dossierIndividuDto.id}"
                                                    class="btn btn-danger"
                                                    sec:authorize="hasRole('ROLE_ADMIN')"><i class="bi bi-person-x"></i></a>
                                            <div class="modal modal-warning fade in" th:id="modal-warning+${dossierIndividuDto.id}">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <form th:action="@{/admin/delete-individu/{id}(id=${dossierIndividuDto.individuId})}" th:method="delete">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title">Suppression d'un individu</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="alert alert-danger text-center">Confirmez-vous la suppression de cet individu : <br>
                                                                    <span th:text="'Numéro id de l\' individu:' + ' ' + ${dossierIndividuDto.individuId} + ' ' + '(' + 'nom = ' + ${dossierIndividuDto.name} + ')'"
                                                                            class="font-weight-bold"></span> ?
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-outline pull-left" data-bs-dismiss="modal">
                                                                    Annuler
                                                                </button>
                                                                <button type="submit" class="btn btn-outline pull-left btn-danger" sec:authorize="hasRole('ROLE_ADMIN')">Supprimer
                                                                </button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        <li class="list-group-item border-0 p-1 bg-transparent">
                                            <a data-bs-toggle="modal"
                                                    href="#"
                                                    data-bs-target="#modal-warning"
                                                    th:attr="data-bs-target='#modal-warning'+${dossierIndividuDto.id}"
                                                    class="btn btn-danger"
                                                    sec:authorize="hasRole('ROLE_ADMIN')"><i class="bi bi-folder-x"></i></a>
                                            <div class="modal modal-warning fade in" th:id="modal-warning+${dossierIndividuDto.id}">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <form th:action="@{/admin/delete-dossier/{id}(id=${dossierIndividuDto.id})}" th:method="delete">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title">Suppression d'un dossier</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="alert alert-danger text-center">Confirmez-vous la suppression de ce dossier : <br>
                                                                    <span th:text="'Dossier:' + ' ' + ${dossierIndividuDto.id} + ' ' + '(' + 'nom = ' + ${dossierIndividuDto.name} + ')'"
                                                                            class="font-weight-bold"></span> ?
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-outline pull-left" data-bs-dismiss="modal">
                                                                    Annuler
                                                                </button>
                                                                <button type="submit" class="btn btn-outline pull-left btn-danger" sec:authorize="hasRole('ROLE_ADMIN')">Supprimer
                                                                </button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <nav th:fragment="pagination" id="pagination" aria-label="pagination" class="mt-5">
                        <div class="col-lg-12 text-center">
                            <div sd:pagination-summary="">info</div>
                        </div>
                        <ul class="d-print-none pagination justify-content-center " sd:pagination="full"></ul>
                    </nav>
                    <div class="alert alert-warning" th:if="${dossiers.isEmpty()}">Aucun individu ne correspond à votre recherche
                    </div>
                </div>
            </section>
        </main>
        <footer th:replace="fragments/footer :: black"></footer>
    </body>
</html>