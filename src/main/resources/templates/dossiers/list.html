<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:sd="http://www.w3.org/1999/xhtml">
<!--/*@thymesVar id="dossiers" type="java.util.List<org.esupportail.esupagape.entity.Dossier>"*/-->
<head th:replace="fragments/head :: head"></head>
<body>
<header th:replace="fragments/header :: header"></header>
<main>
    <section class="text-center">
        <div class="container-fluid">
            <h1 class="mt-3" th:text="'Liste des dossiers ' + ${yearFilter}"></h1>
            <form th:action="@{/dossiers}" method="get">
                <div class="row my-3">
                    <div style="width: 350px;">
                        <div class="input-group">
                            <label class="input-group-text">Année universitaire</label>
                            <select class="form-select" name="yearFilter">
                                <option disabled value="">Choisir</option>
                                <option th:selected="${yearFilter == year}" th:each="year : ${years}" th:value="${year}"
                                        th:text="${year} + ' - ' + ${year + 1} "></option>
                            </select>
                        </div>
                    </div>
                    <div style="width: 350px;">
                        <div class="input-group">
                            <label class="input-group-text" th:for="typeIndividu">Type d'individus</label>
                            <select id="typeIndividu" class="form-select" name="typeIndividu">
                                <option value="">Choisir</option>
                                <option th:selected="${typeIndividu == enumType}"
                                        th:each="enumType : ${typeIndividuList}"
                                        th:value="${enumType}"
                                        th:text="#{'dossier.type-individu.' + ${enumType}}"></option>
                            </select>
                        </div>
                    </div>
                    <div style="width: 350px;">
                        <div class="input-group">
                            <label class="input-group-text" th:for="statusDossier">Statut</label>
                            <select id="statusDossier" class="form-select" name="statusDossier">
                                <option value="">Choisir</option>
                                <option th:selected="${statusDossier == enumStatus}"
                                        th:each="enumStatus : ${statusDossierList}"
                                        th:value="${enumStatus}"
                                        th:text="#{'dossier.status-dossier.' + ${enumStatus}}"></option>
                            </select>
                        </div>
                    </div>
                    <div style="width: 350px;">
                        <input class="form-control"
                               type="text"
                               placeholder="nom, prénom, numéro étudiant"
                               name="fullTextSearch"
                               id="fullTextSearch"
                               size="50" th:value="${fullTextSearch}"> &nbsp;
                    </div>
                    <div class="col-3 text-start">
                        <input class="btn btn-success" type="submit" value="Rechercher">
                        <a class="btn btn-secondary" id="btnClear"
                           th:href="@{/dossiers}">Effacer</a>
                        <a class="btn btn-primary" th:href="@{/individus/create}">Ajouter un
                            individu</a>
                    </div>
                </div>
            </form>

            <table class="table table-striped table-responsive">
                <thead class="text-center mt-2 mb-2 table-secondary">
                <tr>
                    <th class="text-start" scope="col">
                        <a class="sorted" sd:pagination-sort="individu.numEtu">Numéro étudiant</a>
                    </th>
                    <th class="text-start" scope="col">
                        <a class="sorted" sd:pagination-sort="individu.name">Nom</a>
                    </th>
                    <th class="text-start" scope="col">
                        <a class="sorted" sd:pagination-sort="individu.firstName">Prénom</a>
                    </th>
                    <th class="text-start" scope="col">
                        <a class="sorted" sd:pagination-sort="individu.dateOfBirth">Date de naissance</a>
                    </th>
                    <th class="text-start" scope="col">
                        <a class="sorted" sd:pagination-sort="individu.sex">Sexe</a>
                    </th>
                    <th class="text-start" scope="col">
                        <a class="sorted" sd:pagination-sort="type">Type Individu</a>
                    </th>
                    <th class="text-start" scope="col">
                        <a class="sorted" sd:pagination-sort="statusDossier">Statut du dossier</a>
                    </th>
                    <th class="text-start" scope="col"></th>
                </tr>
                </thead>
                <tbody class="text-center">
                <tr th:each="dossier : ${dossiers}">
                    <td class="text-start" th:utext="${dossier.individu.numEtu}"></td>
                    <td class="text-start"
                        th:utext="${#strings.capitalize(#strings.toLowerCase(dossier.individu.name))}"></td>
                    <td class="text-start"
                        th:utext="${#strings.capitalize(#strings.toLowerCase(dossier.individu.firstName))}"></td>
                    <td class="text-start"
                        th:utext="${#temporals.format(dossier.individu.dateOfBirth, 'dd/MM/yyyy')}"></td>
                    <td class="text-start" th:utext="${dossier.individu.sex}"></td>
                    <td class="text-start" th:utext="#{'dossier.type-individu.' +${dossier.type}}"></td>
                    <td class="text-start" th:utext="#{'dossier.status-dossier.' +${dossier.statusDossier}}"></td>
                    <td class="text-start container col-2">
                        <ul class="list-group list-group-horizontal">
                            <li class="list-group-item border-0 p-1">
                                <a class="btn btn-info" th:href="@{/dossiers/{id}(id=${dossier.id})}" role="button"><i
                                        class="bi bi-eye"></i>
                                </a>
                            </li>
                            <li class="list-group-item border-0 p-1">
                                <a data-bs-toggle="modal"
                                   href="#"
                                   data-bs-target="#modal-warning"
                                   th:attr="data-bs-target='#modal-warning'+${dossier.individu.id}"
                                   class="btn btn-danger"
                                   sec:authorize="hasRole('ROLE_ADMIN')"><i class="bi bi-person-x"></i></a>
                                <div class="modal modal-warning fade in" th:id="modal-warning+${dossier.individu.id}">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <form th:action="@{/admin/delete-individu/{id}(id=${dossier.individu.id})}"
                                                  th:method="delete">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Suppression d'un individu</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="alert alert-danger text-center">Confirmez-vous la suppression de
                                                        cet individu : <br>
                                                        <span th:text="'Numéro étudiant:' + ' ' + ${dossier.individu.id} + ' ' + '(' + 'nom = ' + ${dossier.individu.name} + ')'"
                                                              class="font-weight-bold"></span> ?
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-outline pull-left"
                                                            data-bs-dismiss="modal">
                                                        Annuler
                                                    </button>
                                                    <button type="submit" class="btn btn-outline pull-left btn-danger"
                                                            sec:authorize="hasRole('ROLE_ADMIN')">Supprimer
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item border-0 p-1">
                                <a data-bs-toggle="modal"
                                   href="#"
                                   data-bs-target="#modal-warning"
                                   th:attr="data-bs-target='#modal-warning'+${dossier.id}"
                                   class="btn btn-danger"
                                   sec:authorize="hasRole('ROLE_ADMIN')"><i class="bi bi-folder-x"></i></a>
                                <div class="modal modal-warning fade in" th:id="modal-warning+${dossier.id}">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <form th:action="@{/admin/delete-dossier/{id}(id=${dossier.id})}"
                                                  th:method="delete">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Suppression d'un dossier</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="alert alert-danger text-center">Confirmez-vous la suppression de
                                                        ce dossier : <br>
                                                        <span th:text="'Dossier:' + ' ' + ${dossier.id} + ' ' + '(' + 'nom = ' + ${dossier.individu.name} + ')'"
                                                              class="font-weight-bold"></span> ?
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-outline pull-left"
                                                            data-bs-dismiss="modal">
                                                        Annuler
                                                    </button>
                                                    <button type="submit" class="btn btn-outline pull-left btn-danger"
                                                            sec:authorize="hasRole('ROLE_ADMIN')">Supprimer
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </td>

                </tr>
                </tbody>
            </table>
            <nav th:fragment="pagination" id="pagination" aria-label="pagination" class="mt-5">
                <div class="col-lg-12 text-center">
                    <div sd:pagination-summary="">info</div>
                </div>
                <ul class="d-print-none pagination justify-content-center " sd:pagination="full"></ul>
            </nav>
            <div class="alert alert-warning" th:if="${dossiers.isEmpty()}">Aucun individu ne correspond à votre
                recherche
            </div>
        </div>
    </section>
</main>
<footer th:replace="fragments/footer :: black"></footer>
</body>
</html>