<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns:sd="http://www.w3.org/1999/xhtml">
    <!--/*@thymesVar id="dossiers" type="java.util.List<org.esupportail.esupagape.entity.Dossier>"*/-->
    <head th:replace="fragments/head :: head"></head>
    <body>
        <header th:replace="fragments/header :: header"></header>
        <main>
            <section class="text-center">
                <h1 class="mt-3" th:text="'Liste des dossiers ' + ${currentYear}"></h1>
                <a class="btn btn-primary" th:href="@{/individus/create}" type="button">Ajouter</a>
                <div class="container">

                    <form th:action="@{/dossiers}" method="get">
                        <label class="label-list">Rechercher:</label>
                        <input class="mt-2 mb-4" type="text" name="fullTextSearch" id="fullTextSearch" size="50" th:value="${fullTextSearch}" /> &nbsp;
                        <input class="btn btn-success ms-2 mb-1" type="submit" value="Valider" /> &nbsp;
                        <a role="button" class="btn btn-secondary ms-2 mb-1" type="button" id="btnClear" th:href="@{/dossiers}">Effacer</a>
                       <div class="row">
                            <div class="input-group mt-3 mb-4" style="width: 350px;">
                                <label class="input-group-text">Année universitaire</label>
                                <select class="form-select" name="yearFilter" >
                                    <option disabled selected value="">Choisir</option>
                                    <option  th:selected="${yearFilter == year}" th:each="year : ${years}" th:value="${year}" th:text="${year} + ' - ' + ${year + 1} "></option>
                                </select>
                            </div>
                            <div class="input-group mt-3 mb-4" style="width: 350px;">
                                <label class="input-group-text" th:for="typeIndividu">Type d'individus</label>
                                <select class="form-select"  name="typeIndividu" >
                                    <option  value="">Choisir</option>
                                   <option th:selected="${typeIndividu == enumType}" th:each="enumType : ${typeIndividuList}" th:value="${enumType}" th:text="#{'dossier.type-individu.' + ${enumType}}"></option>
                                </select>
                            </div>
                         <div class="input-group mt-3 mb-4" style="width: 500px;">
                                <label class="input-group-text" th:for="statusDossier">Statut</label>
                                <select class="form-select" name="statusDossier">
                                    <option value="">Choisir</option>
                                    <option th:selected="${statusDossier == enumStatus}" th:each="enumStatus : ${statusDossierList}"  th:value="${enumStatus}" th:text="#{'dossier.status-dossier.' + ${enumStatus}}"></option>
                                </select>
                            </div>
                        </div>
                    </form>
                    <table class="table table-striped">
                        <thead class="text-center mt-2 mb-2">
                            <tr>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="individu.numEtu">NUMERO ETUDIANT</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="individu.name">NOM</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="individu.firstName">PRENOM</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="individu.dateOfBirth">DATE DE NAISSANCE</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="individu.sex">SEXE</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="type">TYPE INDIVIDU</a>
                                </th>
                                <th scope="col">
                                    <a class="sorted" sd:pagination-sort="statusDossier">STATUT DU DOSSIER</a>
                                </th>
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            <tr th:each="dossier : ${dossiers}">
                                <td th:utext="${dossier.individu.numEtu}"></td>
                                <td th:utext="${dossier.individu.name}"></td>
                                <td th:utext="${dossier.individu.firstName}"></td>
                                <td th:utext="${dossier.individu.dateOfBirth}"></td>
                                <td th:utext="${dossier.individu.sex}"></td>
                                <td th:utext="#{'dossier.type-individu.' +${dossier.type}}"></td>
                                <td th:utext="#{'dossier.status-dossier.' +${dossier.statusDossier}}"></td>
                                <td class="container col-2">
                                    <a class="btn btn-info" th:href="@{/individus/{id}(id=${dossier.individu.id})}" role="button"><i class="bi bi-eye"></i>
                                    </a>
                                    <a data-bs-toggle="modal"
                                            href="#"
                                            data-bs-target="#modal-warning"
                                            th:attr="data-bs-target='#modal-warning'+${dossier.individu.id}"
                                            class="btn btn-danger"
                                            sec:authorize="hasRole('ROLE_ADMIN')"><i class="bi bi-x"></i></a>
                                    <div class="modal modal-warning fade in" th:id="modal-warning+${dossier.individu.id}">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <form th:action="@{/admin/delete/{id}(id=${dossier.individu.id})}" th:method="delete">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title">Suppression d'un individu</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="alert alert-danger text-center">Confirmez-vous la suppression de cet individu : <br />
                                                            <span th:text="'Numéro étudiant:' + ' ' + ${dossier.individu.id} + ' ' + '(' + 'nom = ' + ${dossier.individu.name} + ')'"
                                                                    class="font-weight-bold"></span> ?
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-outline pull-left" data-bs-dismiss="modal">
                                                            Annuler
                                                        </button>
                                                        <button type="submit" class="btn btn-outline pull-left btn-danger" sec:authorize="hasRole('ROLE_ADMIN')">Supprimer
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <nav th:fragment="pagination" id="pagination" aria-label="pagination">
                        <div class="col-lg-12 text-center">
                            <div sd:pagination-summary="">info</div>
                        </div>
                        <ul class="d-print-none pagination justify-content-center" sd:pagination="full"></ul>
                    </nav>
                    <div class="alert alert-warning" th:if="${dossiers.isEmpty()}">Aucun individu ne correspond à votre recherche</div>
                    <a th:href="@{/dossiers}">Retour à la liste des individus</a>
                </div>
                </div>
            </section>
        </main>
        <footer th:replace="fragments/footer :: black"></footer>
    </body>
</html>