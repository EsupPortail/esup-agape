<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!--/*@thymesVar id="currentDossier" type="org.esupportail.esupagape.entity.Dossier"*/-->
<!--/*@thymesVar id="individu" type="org.esupportail.esupagape.entity.Individu"*/-->
<!--/*@thymesVar id="entretien" type="org.esupportail.esupagape.entity.Entretien"*/-->
<!--/*@thymesVar id="typeContacts" type="java.util.List<org.esupportail.esupagape.entity.enums.TypeContact>"*/-->
<head th:replace="fragments/head :: head"></head>
<body>
<header th:replace="fragments/header :: header"></header>
<main class="d-inline-flex">
    <div th:replace="fragments/side :: side"></div>
    <div class="agape-content">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/dossiers}" class="text-center ">Liste des dossiers</a></li>
                <li class="breadcrumb-item"><a th:href="@{'/dossiers/' + ${currentDossier.id} + '/entretiens'}" class="text-center ">Liste des entretiens</a></li>
                <li class="breadcrumb-item active" aria-current="page"><span th:text="'Entretien du ' + ${#temporals.format(entretien.date, 'dd/MM/yyyy HH:mm')}"></span></li>
            </ol>
        </nav>
        <div th:replace="fragments/tabs-years :: tabs-years"></div>
        <div th:replace="fragments/tabs-content :: tabs-content(active='entretiens')"></div>
        <div class="m-3">
            <h4><span th:text="'Entretien du ' + ${#temporals.format(entretien.date, 'dd/MM/yyyy HH:mm')}"></span></h4>
            <hr>
            <div class="row">
                <div class="col-12 col-xl-6">
                    <form id="form-entretien" class="container" th:method="put" th:action="@{/dossiers/{id}/entretiens/{entretienId}/update(id=${currentDossier.id},entretienId=${entretien.id})}" th:object="${entretien}">
                        <div class="mb-3">
                            <label th:for="date" class="form-label">Date de lâ€™entretien</label>
                            <input disabled id="date" type="datetime-local" class="form-control" th:name="date" th:value="${entretien.date}">
                            <p th:if="${#fields.hasErrors('date')}" th:errorclass="error" th:errors="*{date}"></p>
                        </div>
                        <label th:for="${typeContact}" class="form-label">Type de contact</label>
                        <th:block th:each="typeContact : ${typeContacts}">
                            <div class="form-check">
                                <input disabled type="radio" class="form-check-input" th:id="${typeContact}" name="typeContact" th:value="${typeContact}" th:checked="${entretien.typeContact == typeContact}">
                                <label class="form-check-label" th:for="${typeContact}" th:text="#{'entretien.type-contact.' +${typeContact}}"></label>
                            </div>
                        </th:block>
                        <div class="mt-3">
                            <label for="interlocuteur" class="form-label">Interlocuteur</label>
                            <input disabled type="text" class="form-control" id="interlocuteur" th:value="${entretien.interlocuteur}" th:field="*{interlocuteur}">
                            <p th:if="${#fields.hasErrors('interlocuteur')}" th:errorclass="error" th:errors="*{interlocuteur}"></p>
                        </div>
                        <div class="mt-3">
                            <label for="compteRendu" class="form-label">Compte rendu</label>
                            <textarea disabled class="form-control"  id="compteRendu" th:field="*{compteRendu}" th:value="${entretien.compteRendu}"></textarea>
                            <p th:if="${#fields.hasErrors('compteRendu')}" th:errorclass="error" th:errors="*{compteRendu}"></p>
                        </div>
                        <input onclick="unlockForm(this);" id="unlock-entretien" type="button" value="Modifier" class="btn btn-warning mt-2">
                        <input onclick="lockForm(this);" id="lock-entretien" type="button" value="Annuler" class="btn btn-danger mt-2 d-none">
                        <button type="submit" id="submit-entretien" class="btn btn-success mt-2 d-none">Enregistrer</button>
                    </form>
                </div>
                <div class="col-12 col-xl-6">
                    <table class="table table-striped" th:if="${attachments.size() > 0}">
                        <tr>
                            <th>Nom</th>
                            <th></th>
                        </tr>
                    <th:block th:each="attachment : ${attachments}">
                        <tr>
                            <td class="align-middle">
                                <a th:href="'/dossiers/' + ${currentDossier.id} + '/entretiens/' + ${entretien.id} + '/get-attachment/' + ${attachment.id}" th:text="${attachment.fileName}"></a>
                            </td>
                            <td class="align-middle">
                                <form th:action="'/dossiers/' + ${currentDossier.id} + '/entretiens/' + ${entretien.id} + '/delete-attachment/' + ${attachment.id}"
                                      th:method="delete"
                                      enctype="multipart/form-data">
                                    <button type="submit" class="btn btn-sm btn-danger"><i class="bi bi-trash3"></i></button>
                                </form>
                            </td>
                        </tr>
                    </th:block>
                    </table>
                    <form class="me-2" th:action="'/dossiers/' + ${currentDossier.id} + '/entretiens/' + ${entretien.id} + '/add-attachments'" th:method="post" enctype="multipart/form-data">
                        <label class="form-label">Ajouter un fichier</label>
                        <input type="file" name="multipartFiles" multiple class="form-control mb-2" required>
                        <input type="submit" class="btn btn-primary" value="Ajouter">
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>
<footer th:replace="fragments/footer :: black"></footer>
<div th:replace="fragments/flash :: flash"></div>
</body>
</html>