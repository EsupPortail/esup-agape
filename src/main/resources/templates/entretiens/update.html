<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <!--/*@thymesVar id="currentDossier" type="org.esupportail.esupagape.entity.Dossier"*/-->
    <!--/*@thymesVar id="individu" type="org.esupportail.esupagape.entity.Individu"*/-->
    <!--/*@thymesVar id="entretien" type="org.esupportail.esupagape.entity.Entretien"*/-->
    <!--/*@thymesVar id="typeContacts" type="java.util.List<org.esupportail.esupagape.entity.enums.TypeContact>"*/-->
    <!--/*@thymesVar id="personLdap" type="org.esupportail.esupagape.service.ldap.PersonLdap"*/-->
    <head th:replace="fragments/head :: head"></head>
    <body>
        <header th:replace="fragments/header :: header"></header>
        <main class="d-inline-flex">
            <div th:replace="fragments/side :: side"></div>
            <div class="agape-content agape-content-side">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a th:href="@{/dossiers}" class="text-center ">Liste des dossiers</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a th:href="@{'/dossiers/' + ${currentDossier.id} + '/entretiens'}" class="text-center ">Liste des entretiens</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page"><span th:text="'Entretien du ' + ${#temporals.format(entretien.date, 'dd/MM/yyyy HH:mm')}"></span></li>
                    </ol>
                </nav>
                <div th:replace="fragments/tabs-years :: tabs-years"></div>
                <div th:replace="fragments/tabs-content :: tabs-content(active='entretiens')"></div>
                <div class="m-3">
                    <h4><span th:text="'Entretien du ' + ${#temporals.format(entretien.date, 'dd/MM/yyyy HH:mm')}"></span></h4>
                    <hr>
                    <div class="row">
                        <div class="col-12 col-xl-6">
                            <form id="form-entretien"
                                    class="container"
                                    th:method="put"
                                    th:action="@{/dossiers/{id}/entretiens/{entretienId}/update(id=${currentDossier.id},entretienId=${entretien.id})}"
                                    th:object="${entretien}">
                                <div class="mb-3">
                                    <label th:for="date" class="form-label">Date de l’entretien</label>
                                    <input disabled id="date" type="datetime-local" class="form-control" th:name="date" th:value="${entretien.date}">
                                    <p th:if="${#fields.hasErrors('date')}" th:errorclass="error" th:errors="*{date}"></p>
                                </div>
                                <label th:for="${typeContact}" class="form-label">Type de contact</label>
                                <th:block th:each="typeContact : ${typeContacts}">
                                    <div class="form-check">
                                        <input disabled
                                                type="radio"
                                                class="form-check-input"
                                                th:id="${typeContact}"
                                                name="typeContact"
                                                th:value="${typeContact}"
                                                th:checked="${entretien.typeContact == typeContact}">
                                        <label class="form-check-label" th:for="${typeContact}" th:text="#{'entretien.typeContact.' +${typeContact}}"></label>
                                    </div>
                                </th:block>
                                <!-- <div class="mt-3">
                                     <label for="displayName" class="form-label">Interlocuteur</label>
                                     <input disabled type="text" class="form-control" id="displayName" th:value="${entretien.interlocuteur}" name="displayName">
                                 </div>-->
                                <div class="mt-3">
                                    <div class="col-4" style="width: 250px;">
                                        <label class="form-label" for="interlocuteur">Interlocuteur</label>
                                    </div>
                                    <div class="mt-3">
                                        <textarea disabled
                                                id="interlocuteur"
                                                name="interlocuteur"
                                                class="form-control"
                                                th:text="${entretien.interlocuteur}"
                                                th:readonly="${entretien.interlocuteur != ''}"></textarea>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <label for="compteRendu" class="form-label">Compte rendu</label>
                                    <textarea disabled class="form-control" id="compteRendu" th:field="*{compteRendu}" th:value="${entretien.compteRendu}"></textarea>
                                    <p th:if="${#fields.hasErrors('compteRendu')}" th:errorclass="error" th:errors="*{compteRendu}"></p>
                                </div>
                                <div class="float-buttons">
                                    <button onclick="unlockForm(this);" id="unlock-entretien" type="button" value="Modifier" class="btn btn-warning"><i class="fa-solid fa-pen"></i></button>
                                    <button onclick="lockForm(this);" id="lock-entretien" type="button" value="Annuler" class="btn btn-danger d-none"><i class="fa-solid fa-xmark"></i></button>
                                    <button type="submit" id="submit-entretien" class="btn btn-success d-none">
                                        <svg style="color: white; width: 20px; margin-bottom: 3px; margin-left: 1px;"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. -->
                                            <path d="M433.1 129.1l-83.9-83.9C342.3 38.32 327.1 32 316.1 32H64C28.65 32 0 60.65 0 96v320c0 35.35 28.65 64 64 64h320c35.35 0 64-28.65 64-64V163.9C448 152.9 441.7 137.7 433.1 129.1zM224 416c-35.34 0-64-28.66-64-64s28.66-64 64-64s64 28.66 64 64S259.3 416 224 416zM320 208C320 216.8 312.8 224 304 224h-224C71.16 224 64 216.8 64 208v-96C64 103.2 71.16 96 80 96h224C312.8 96 320 103.2 320 112V208z"
                                                    fill="white"></path>
                                        </svg>
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div class="col-12 col-xl-6">
                            <label th:for="date" class="form-label">Pièces jointes</label>
                            <table class="table table-striped" th:if="${attachments.size() > 0}">
                                <tr>
                                    <th>Nom</th>
                                    <th></th>
                                </tr>
                                <th:block th:each="attachment : ${attachments}">
                                    <tr>
                                        <td class="align-middle">
                                            <a th:href="'/dossiers/' + ${currentDossier.id} + '/entretiens/' + ${entretien.id} + '/get-attachment/' + ${attachment.id}"
                                                    th:text="${attachment.fileName}"></a>
                                        </td>
                                        <td class="align-middle">
                                            <form th:action="'/dossiers/' + ${currentDossier.id} + '/entretiens/' + ${entretien.id} + '/delete-attachment/' + ${attachment.id}"
                                                    th:method="delete"
                                                    enctype="multipart/form-data">
                                                <button type="submit" class="btn btn-sm btn-danger"><i class="fa-solid fa-trash"></i></button>
                                            </form>
                                        </td>
                                    </tr>
                                </th:block>
                            </table>
                            <form class="me-2" th:action="'/dossiers/' + ${currentDossier.id} + '/entretiens/' + ${entretien.id} + '/add-attachments'" th:method="post" enctype="multipart/form-data">
                                <label class="form-label">Ajouter un fichier</label>
                                <input type="file" name="multipartFiles" multiple class="form-control mb-2" required>
                                <input type="submit" class="btn btn-primary" value="Ajouter">
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer th:replace="fragments/footer :: black"></footer>
        <div th:replace="fragments/flash :: flash"></div>
    </body>
</html>